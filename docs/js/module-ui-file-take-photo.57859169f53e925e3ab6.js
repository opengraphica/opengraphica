/*! For license information please see module-ui-file-take-photo.57859169f53e925e3ab6.js.LICENSE.txt */
"use strict";(self.webpackChunkOpenGraphica=self.webpackChunkOpenGraphica||[]).push([[1142],{42882:(e,a,t)=>{t.r(a),t.d(a,{default:()=>y});var l=t(66252),o=t(3577);const i={ref:"video",autoplay:"true",class:"is-fullwidth"},n={class:"has-text-right mt-4"};var r=t(2262),u=t(26418),c=t(64670),s=t(43019),d=t(16131),m=t(8778),h=t(67340),v=t(91457),p=t(93249),g=t(75930),f=t(23120);let w=1;const k=(0,l.aZ)({name:"ModuleFileTakePhoto",directives:{loading:s.ZP.directive},components:{ElAlert:u.ZP,ElButton:c.ZP,ElOption:d.BT,ElSelect:d.ZP},emits:["update:title","close"],setup(e,{emit:a}){a("update:title","module.fileTakePhoto.title");const t=(0,v.$b)("$notify"),o=(0,r.iH)(!0),i=(0,r.iH)(),n=(0,r.iH)(null),u=(0,r.iH)(),c=(0,r.iH)(null),s=(0,r.iH)(!1),d=(0,r.iH)("environment");let k;async function y(){C();try{n.value=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:d.value,width:{ideal:1920},height:{ideal:1920}}}),u.value=n.value.getTracks(),c.value=u.value[0],k.srcObject=n.value}catch(e){s.value=!0}}async function C(){null!=c.value&&c.value.stop(),k.pause(),k.src="",k.load()}return(0,l.YP)([d],(()=>{y()})),(0,l.bv)((async()=>{k=i.value,await y(),o.value=!1})),(0,l.Ah)((()=>{C()})),{hasCameraError:s,loading:o,video:i,facingMode:d,onCancel:function(){a("close")},onTake:async function(){k.pause(),o.value=!0,await(0,l.Y3)();try{const e=k.videoWidth,a=k.videoHeight,t=document.createElement("canvas"),l=t.getContext("2d");if(l){t.width=e,t.height=a,l.drawImage(k,0,0);let o=new Image;await new Promise(((e,a)=>{o.onload=()=>{e()},o.onerror=()=>{a()},o.src=t.toDataURL("image/png")})),await m.Z.dispatch("runAction",{action:new p.x("fileTakePhoto","action.fileTakePhoto",[...0===h.default.get("layers").length?[new f._({width:e,height:a})]:[],new g.D({type:"raster",name:"Webcam #"+w++,width:e,height:a,data:{sourceImage:o}})])})}}catch(e){t({type:"error",title:"Error Occurred",message:v.Ol})}o.value=!1,a("close")}}}}),y=(0,t(83744).Z)(k,[["render",function(e,a,t,r,u,c){const s=(0,l.up)("el-alert"),d=(0,l.up)("el-option"),m=(0,l.up)("el-select"),h=(0,l.up)("el-button"),v=(0,l.Q2)("loading");return(0,l.wy)(((0,l.wg)(),(0,l.iD)("div",null,[e.hasCameraError?((0,l.wg)(),(0,l.j4)(s,{key:0,title:e.$t("module.fileTakePhoto.noCameraError.title"),type:"warning","show-icon":"",closable:!1},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.toDisplayString)(e.$t("module.fileTakePhoto.noCameraError.message")),1)])),_:1},8,["title"])):((0,l.wg)(),(0,l.iD)(l.HY,{key:1},[(0,l.Wm)(m,{modelValue:e.facingMode,"onUpdate:modelValue":a[0]||(a[0]=a=>e.facingMode=a),class:"mx-0 mt-0 mb-2 is-fullwidth",placeholder:e.$t("module.fileTakePhoto.selectCamera.placeholder")},{default:(0,l.w5)((()=>[(0,l.Wm)(d,{key:"user",value:"user",label:e.$t("module.fileTakePhoto.selectCamera.user")},null,8,["label"]),(0,l.Wm)(d,{key:"environment",value:"environment",label:e.$t("module.fileTakePhoto.selectCamera.environment")},null,8,["label"])])),_:1},8,["modelValue","placeholder"]),(0,l._)("video",i,null,512),(0,l._)("div",n,[(0,l.Wm)(h,{onClick:e.onCancel},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.toDisplayString)(e.$t("button.cancel")),1)])),_:1},8,["onClick"]),(0,l.Wm)(h,{type:"primary",onClick:e.onTake},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.toDisplayString)(e.$t("button.take")),1)])),_:1},8,["onClick"])])],64))])),[[v,e.loading]])}]])}}]);