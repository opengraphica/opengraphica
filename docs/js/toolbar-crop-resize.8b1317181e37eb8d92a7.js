"use strict";(self.webpackChunkOpenGraphica=self.webpackChunkOpenGraphica||[]).push([[6417],{54140:(e,l,a)=>{a.r(l),a.d(l,{default:()=>I});var t=a(66252),i=a(3577);const u={class:"is-flex container is-align-items-center is-justify-content-space-between mx-auto"},o={class:"py-2 pl-4 is-text-nowrap is-text-ellipsis"},n={class:"is-block my-2 is-text-ellipsis"},s=(0,t._)("i",{class:"bi bi-crop","aria-hidden":"true"},null,-1),r={class:"py-2 px-3 is-text-nowrap"},p={key:0,class:"bi bi-x"},m={key:0,class:"bi bi-sliders"},v={class:"mt-3 mx-4.5"},c={class:"px-4.5 my-3"},d={key:0,class:"bi bi-check"};var b=a(2262),f=a(64670),w=a(9069),g=a(98653),x=a(43019),h=a(41627),y=a(72294),k=a(16131),z=a(10409),U=a(95452),C=a(91648),R=a(8778),W=a(67340),D=a(86617),F=a(93249),_=a(23120),V=a(32988),H=a(63063);const $=(0,t.aZ)({name:"ToolbarCropResize",directives:{loading:x.ZP.directive},components:{ElButton:f.ZP,ElButtonGroup:f.MO,ElForm:w.ZP,ElFormItem:w.nH,ElInputNumber:g.Z,ElOption:k.BT,ElPopover:h.ZP,ElRadioButton:y.dn,ElRadioGroup:y.KD,ElSelect:k.ZP,ElSwitch:z.ZP},props:{},emits:["close"],setup(e,{emit:l}){const a=(0,b.iH)(!1),{viewWidth:i}=(0,b.BK)(C.Z.state);let u=!1;const o=(0,b.iH)("crop"),n=(0,b.iH)(null!=D.eb.value),s=(0,b.iH)(W.default.get("measuringUnits")),r=(0,b.iH)(W.default.get("resolutionX")),p=(0,b.iH)(W.default.get("resolutionY")),m=(0,b.iH)(W.default.get("resolutionUnits")),v=(0,b.iH)((0,H.L3)(D.bf.value,"px",s.value,r.value,m.value)),c=(0,b.iH)((0,H.L3)(D.Cb.value,"px",s.value,p.value,m.value)),d=(0,t.Fl)({get:()=>r.value,set(e){r.value=e,p.value=e}});async function f(e){u=!0,"crop"===o.value&&(D.bf.value=Math.ceil((0,H.L3)(e,s.value,"px",r.value,m.value))),D.eb.value&&("crop"===o.value&&(D.Cb.value=Math.ceil(D.bf.value/D.eb.value)),c.value=parseFloat((e/D.eb.value).toFixed("px"===s.value?0:2))),await(0,t.Y3)(),u=!1}async function w(e){u=!0,"crop"===o.value&&(D.Cb.value=Math.ceil((0,H.L3)(e,s.value,"px",p.value,m.value))),D.eb.value&&("crop"===o.value&&(D.bf.value=Math.ceil(D.Cb.value*D.eb.value)),v.value=parseFloat((e*D.eb.value).toFixed("px"===s.value?0:2))),await(0,t.Y3)(),u=!1}function g(){a.value=i.value<500}async function x(e){let l=[];for(let a of e)if("group"===a.type)await x(a.layers);else if("raster"===a.type||"rasterSequence"===a.type){const e=(new DOMMatrix).translateSelf(-D.t$.value,-D.we.value).multiplySelf(a.transform);l.push(new V.E({id:a.id,transform:e}))}return l}return(0,t.YP)([s],(([e],[l])=>{v.value=parseFloat((0,H.L3)(v.value,l,e,r.value,m.value).toFixed("px"===e?0:2)),c.value=parseFloat((0,H.L3)(c.value,l,e,p.value,m.value).toFixed("px"===e?0:2))})),(0,t.YP)([D.bf,D.Cb],(([e,l])=>{u||"crop"!==o.value||(v.value=parseFloat((0,H.L3)(e,"px",s.value,r.value,m.value).toFixed("px"===s.value?0:2)),c.value=parseFloat((0,H.L3)(l,"px",s.value,p.value,m.value).toFixed("px"===s.value?0:2)))}),{immediate:!0}),(0,t.YP)([n],(([e])=>{D.eb.value=e?v.value/c.value:null})),(0,t.YP)([i],(()=>{g()})),(0,t.YP)([o],(async([e])=>{"resample"===e?(n.value=!1,await(0,t.Y3)(),v.value=parseFloat((0,H.L3)(W.default.get("width"),"px",s.value,r.value,m.value).toFixed("px"===s.value?0:2)),c.value=parseFloat((0,H.L3)(W.default.get("height"),"px",s.value,p.value,m.value).toFixed("px"===s.value?0:2)),await f(v.value),await w(c.value),D.we.value=0,D.t$.value=0,n.value=!0):(v.value=parseFloat((0,H.L3)(W.default.get("width"),"px",s.value,r.value,m.value).toFixed("px"===s.value?0:2)),c.value=parseFloat((0,H.L3)(W.default.get("height"),"px",s.value,p.value,m.value).toFixed("px"===s.value?0:2)),await f(v.value),await w(c.value),D.we.value=0,D.t$.value=0,n.value=!1)})),(0,t.bv)((()=>{g()})),{isDimensionRatioLock:n,measuringUnits:s,dimensionUnitOptions:[{value:"px",label:"measurement.pixels"},{value:"mm",label:"measurement.millimeters"},{value:"cm",label:"measurement.centimeters"},{value:"in",label:"measurement.inches"}],resolutionUnitOptions:[{value:"px/in",label:"measurement.pixelsPerInch"},{value:"px/mm",label:"measurement.pixelsPerMillimeter"},{value:"px/cm",label:"measurement.pixelsPerCentimeter"}],resolution:d,resolutionUnits:m,resizeInputWidth:v,resizeInputHeight:c,onInputResizeWidth:f,onInputResizeHeight:w,isMobileView:a,mode:o,enableSnapping:D.f,onCancel:function(){l("close")},onDone:async function(){U.Z.emit("app.wait.startBlocking",{id:"toolCropResizeCalculating",label:"canvas.toolbar.cropResize.waitLabel"});try{const e=W.default.get("layers");let l=await x(e);await R.Z.dispatch("runAction",{action:new F.x("moduleCropResize","action.moduleCropResize",[...l,new _._({width:D.bf.value,height:D.Cb.value,measuringUnits:s.value,resolutionX:r.value,resolutionY:p.value,resolutionUnits:m.value})])})}catch(e){}U.Z.emit("app.wait.stopBlocking",{id:"toolCropResizeCalculating"}),l("close")}}}}),I=(0,a(83744).Z)($,[["render",function(e,l,a,b,f,w){const g=(0,t.up)("el-button"),x=(0,t.up)("el-input-number"),h=(0,t.up)("el-button-group"),y=(0,t.up)("el-option"),k=(0,t.up)("el-select"),z=(0,t.up)("el-form-item"),U=(0,t.up)("el-switch"),C=(0,t.up)("el-form"),R=(0,t.up)("el-popover"),W=(0,t.Q2)("t");return(0,t.wg)(),(0,t.iD)("div",u,[(0,t._)("div",o,[(0,t._)("div",n,[s,(0,t.Uk)(" "+(0,i.toDisplayString)(e.$t("toolbar.cropResize.title")),1)])]),(0,t._)("div",r,[(0,t.Wm)(g,{plain:"",type:"text",class:"px-4","aria-label":e.$t("button.cancel"),onClick:e.onCancel},{default:(0,t.w5)((()=>[e.isMobileView?((0,t.wg)(),(0,t.iD)("i",p)):((0,t.wg)(),(0,t.iD)(t.HY,{key:1},[(0,t.Uk)((0,i.toDisplayString)(e.$t("button.cancel")),1)],2112))])),_:1},8,["aria-label","onClick"]),(0,t.Wm)(R,{placement:"bottom","popper-class":"ogr-dock-popover",trigger:"click",width:250},{reference:(0,t.w5)((()=>[(0,t.Wm)(g,{plain:"",type:"text",class:"px-4 ml-0 mr-2","aria-label":e.$t("button.settings")},{default:(0,t.w5)((()=>[e.isMobileView?((0,t.wg)(),(0,t.iD)("i",m)):((0,t.wg)(),(0,t.iD)(t.HY,{key:1},[(0,t.Uk)((0,i.toDisplayString)(e.$t("button.settings")),1)],2112))])),_:1},8,["aria-label"])])),default:(0,t.w5)((()=>[(0,t.wy)((0,t._)("h2",v,null,512),[[W,"button.settings"]]),(0,t.Wm)(C,{novalidate:"novalidate",action:"javascript:void(0)"},{default:(0,t.w5)((()=>[(0,t.kq)('el-form-item class="el-form-item--menu-item mb-1" label="Mode">\n                        <el-radio-group\n                            v-model="mode"\n                            size="small">\n                            <el-radio-button label="crop">Crop</el-radio-button>\n                            <el-radio-button label="resample">Resample</el-radio-button>\n                        </el-radio-group>\n                    </el-form-item'),(0,t._)("div",c,[(0,t.Wm)(h,{class:"el-button-group--flex is-fullwidth"},{default:(0,t.w5)((()=>[(0,t.Wm)(x,{modelValue:e.resizeInputWidth,"onUpdate:modelValue":l[0]||(l[0]=l=>e.resizeInputWidth=l),"aria-label":e.$t("toolbar.cropResize.width"),size:"small",class:"is-flex-grow-1","suffix-text":e.measuringUnits,onInput:e.onInputResizeWidth},null,8,["modelValue","aria-label","suffix-text","onInput"]),(0,t.Wm)(g,{size:"small","aria-label":e.$t("toolbar.cropResize.linkWidthHeight"),class:"px-3",disabled:"resample"===e.mode,onClick:l[1]||(l[1]=l=>e.isDimensionRatioLock=!e.isDimensionRatioLock)},{default:(0,t.w5)((()=>[(0,t._)("i",{class:(0,i.normalizeClass)(["bi",e.isDimensionRatioLock?"bi-lock-fill":"bi-unlock-fill"]),"aria-hidden":"true"},null,2)])),_:1},8,["aria-label","disabled"]),(0,t.Wm)(x,{modelValue:e.resizeInputHeight,"onUpdate:modelValue":l[2]||(l[2]=l=>e.resizeInputHeight=l),"aria-label":e.$t("toolbar.cropResize.height"),size:"small",class:"is-flex-grow-1","suffix-text":e.measuringUnits,onInput:e.onInputResizeHeight},null,8,["modelValue","aria-label","suffix-text","onInput"])])),_:1})]),(0,t.Wm)(z,{class:"el-form-item--menu-item mb-1",label:e.$t("toolbar.cropResize.dimensionUnits")},{default:(0,t.w5)((()=>[(0,t.Wm)(k,{style:{width:"5rem"},size:"small",modelValue:e.measuringUnits,"onUpdate:modelValue":l[3]||(l[3]=l=>e.measuringUnits=l)},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.dimensionUnitOptions,(l=>((0,t.wg)(),(0,t.j4)(y,{key:l.value,label:l.value,value:l.value},{default:(0,t.w5)((()=>[(0,t.Uk)((0,i.toDisplayString)(e.$t(l.label)),1)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["label"]),(0,t.Wm)(z,{class:"el-form-item--menu-item mb-1",label:e.$t("toolbar.cropResize.resolution")},{default:(0,t.w5)((()=>[(0,t.Wm)(x,{style:{width:"6rem"},size:"small",modelValue:e.resolution,"onUpdate:modelValue":l[4]||(l[4]=l=>e.resolution=l)},null,8,["modelValue"])])),_:1},8,["label"]),(0,t.Wm)(z,{class:"el-form-item--menu-item mb-1",label:e.$t("toolbar.cropResize.resolutionUnits")},{default:(0,t.w5)((()=>[(0,t.Wm)(k,{style:{width:"6rem"},size:"small",modelValue:e.resolutionUnits,"onUpdate:modelValue":l[5]||(l[5]=l=>e.resolutionUnits=l)},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.resolutionUnitOptions,(l=>((0,t.wg)(),(0,t.j4)(y,{key:l.value,label:l.value,value:l.value},{default:(0,t.w5)((()=>[(0,t.Uk)((0,i.toDisplayString)(e.$t(l.label)),1)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["label"]),(0,t.Wm)(z,{class:"el-form-item--menu-item el-form-item--has-content-right mb-1",label:e.$t("toolbar.cropResize.snapping")},{default:(0,t.w5)((()=>[(0,t.Wm)(U,{modelValue:e.enableSnapping,"onUpdate:modelValue":l[6]||(l[6]=l=>e.enableSnapping=l)},null,8,["modelValue"])])),_:1},8,["label"])])),_:1})])),_:1}),(0,t.Wm)(g,{"aria-label":e.$t("button.done"),plain:"",type:"primary",class:"ml-0",onClick:e.onDone},{default:(0,t.w5)((()=>[e.isMobileView?((0,t.wg)(),(0,t.iD)("i",d)):((0,t.wg)(),(0,t.iD)(t.HY,{key:1},[(0,t.Uk)((0,i.toDisplayString)(e.$t("button.done")),1)],2112))])),_:1},8,["aria-label","onClick"])])])}]])}}]);