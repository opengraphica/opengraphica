"use strict";(self.webpackChunkOpenGraphica=self.webpackChunkOpenGraphica||[]).push([[9592],{15683:(e,t,a)=>{a.r(t),a.d(t,{saveImage:()=>i,saveImageAs:()=>o,saveImageToTemporaryStorage:()=>s});var r=a(67340),n=a(93162);async function i(e){const t=d(),a=await e.createWritable();await a.write(new Blob([JSON.stringify(t,null,"\t")],{type:"text/plain"})),await a.close()}async function o(e={}){const t=d(),a=(e.fileName||"image").replace(/(\.(json|png|jpg|jpeg|webp|gif|bmp|tif|tiff))$/gi,"")+".json";(0,n.saveAs)(new Blob([JSON.stringify(t,null,"\t")],{type:"text/plain"}),a)}async function s(){const e=d();try{localStorage.setItem("openGraphicaSave_0",JSON.stringify(e))}catch(e){throw console.warn(e),new Error("Could not save file. It may be too large.")}}function d(){return{version:"0.0.1-ALPHA.1",date:(new Date).toISOString(),background:r.default.get("background"),colorModel:r.default.get("colorModel"),colorSpace:r.default.get("colorSpace"),drawOriginX:r.default.get("drawOriginX"),drawOriginY:r.default.get("drawOriginY"),height:r.default.get("height"),layerIdCounter:r.default.get("layerIdCounter"),measuringUnits:r.default.get("measuringUnits"),resolutionUnits:r.default.get("resolutionUnits"),resolutionX:r.default.get("resolutionX"),resolutionY:r.default.get("resolutionY"),scaleFactor:r.default.get("scaleFactor"),selectedLayerIds:r.default.get("selectedLayerIds"),width:r.default.get("width"),layers:g(r.default.get("layers"))}}function g(e){let t=[];for(let a of e){let e={blendingMode:a.blendingMode,filters:a.filters,groupId:a.groupId,height:a.height,id:a.id,name:a.name,opacity:a.opacity,transform:[a.transform.a,a.transform.b,a.transform.c,a.transform.d,a.transform.e,a.transform.f],type:a.type,visible:a.visible,width:a.width};if("group"===a.type)e={...e,type:"group",expanded:a.expanded,layers:g(a.layers)};else if("raster"===a.type){const t=document.createElement("canvas");t.width=a.width,t.height=a.height;const r=t.getContext("2d");try{if(!r)throw new Error("Missing canvas context");r.imageSmoothingEnabled=!1,r.drawImage(a.data.sourceImage,0,0),e={...e,type:"raster",data:{sourceImageSerialized:t.toDataURL("image/png")}},t.width=1,t.height=1}catch(e){throw t.width=1,t.height=1,e}}else if("rasterSequence"===a.type){const t=a,r=[];for(let e of t.data.sequence){const t=document.createElement("canvas");t.width=a.width,t.height=a.height;const n=t.getContext("2d");try{if(!n)throw new Error("Missing canvas context");n.imageSmoothingEnabled=!1,n.drawImage(e.image.sourceImage,0,0),r.push({start:e.start,end:e.end,image:{sourceImageSerialized:t.toDataURL("image/png")}}),t.width=1,t.height=1}catch(e){throw t.width=1,t.height=1,e}}e={...e,type:"rasterSequence",data:{sequence:r}}}else"vector"===a.type?e={...e,type:"vector",data:a.data}:"text"===a.type&&(e={...e,type:"text",data:a.data});t.push(e)}return t}}}]);