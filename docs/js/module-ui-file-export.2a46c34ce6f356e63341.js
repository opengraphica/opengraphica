"use strict";(self.webpackChunkOpenGraphica=self.webpackChunkOpenGraphica||[]).push([[5136],{21806:(e,l,i)=>{i.r(l),i.d(l,{default:()=>x});var a=i(66252),t=i(49963),o=i(3577);const n=(0,a.Uk)("%"),r={class:"has-text-right"};var u=i(2262),d=i(26418),p=i(64670),m=i(86283),f=i(9069),s=i(92056),g=i(97965),c=i(98653),w=i(43019),y=i(45929),k=i(16131),v=i(78874),b=i(10409),F=i(67340),h=i(91457),S=i(13088),D=i(98341);const E=(0,a.aZ)({name:"ModuleFileExport",directives:{loading:w.ZP.directive},components:{ElAlert:d.ZP,ElButton:p.ZP,ElCol:m.ZP,ElForm:f.ZP,ElFormItem:f.nH,ElFormItemGroup:s.Z,ElInput:g.default,ElInputNumber:c.Z,ElOption:k.BT,ElRow:y.ZP,ElSelect:k.ZP,ElSlider:v.ZP,ElSwitch:b.ZP},emits:["update:title","close"],setup(e,{emit:l}){l("update:title","module.fileExport.title");const i=(0,h.$b)("$notify"),t=(0,u.iH)(),o=(0,u.iH)(!1),n=[{value:"png",label:"PNG"},{value:"jpg",label:"JPG"},{value:"webp",label:"WEBP"},{value:"gif",label:"GIF"},{value:"bmp",label:"BMP"},{value:"tiff",label:"TIFF"}].filter((e=>(0,S.isfileFormatSupported)(e.value))),r=(0,a.Fl)((()=>["jpg","gif","webp"].includes(p.workingFile.fileType))),d=(0,a.Fl)((()=>["gif"].includes(p.workingFile.fileType))),p=(0,u.qj)({workingFile:{saveBackDirectly:!1,fileName:F.default.get("fileName"),fileType:"png",layerSelection:"all",quality:100,dithering:""}}),m=F.default.get("fileHandle");let f=!1;if(m)for(const e of n)if(m.name.endsWith(e.value)){f=!0,p.workingFile.fileType=e.value,p.workingFile.saveBackDirectly=!0;break}return{form:t,loading:o,canSaveBackDirectly:f,fileHandle:m,layerSelectionOptions:[{value:"all",label:"All"},{value:"selected",label:"Selected"}],fileTypeOptions:n,ditheringOptions:[{value:"",label:"module.fileExport.ditheringOption.none"},{value:"Atkinson",label:"module.fileExport.ditheringOption.atkinson"},{value:"Atkinson-serpentine",label:"module.fileExport.ditheringOption.atkinsonSerpentine"},{value:"FloydSteinberg",label:"module.fileExport.ditheringOption.floydSteinberg"},{value:"FloydSteinberg-serpentine",label:"module.fileExport.ditheringOption.floydSteinbergSerpentine"},{value:"FalseFloydSteinberg",label:"module.fileExport.ditheringOption.falseFloydSteinberg"},{value:"FalseFloydSteinberg-serpentine",label:"module.fileExport.ditheringOption.falseFloydSteinbergSerpentine"},{value:"Stucki",label:"module.fileExport.ditheringOption.stucki"},{value:"Stucki-serpentine",label:"module.fileExport.ditheringOption.stuckiSerpentine"}],showQualitySetting:r,showDitheringSetting:d,formData:p,formValidationRules:{},onCancel:function(){l("close")},onCreate:async function(){if(t.value)try{await t.value.validate(),o.value=!0;try{const e={fileType:p.workingFile.fileType,layerSelection:p.workingFile.layerSelection,quality:p.workingFile.quality/100,dithering:p.workingFile.dithering};p.workingFile.saveBackDirectly?e.toFileHandle=m:(F.default.set("fileName",p.workingFile.fileName.replace(D.z,"")),e.fileName=p.workingFile.fileName),await(0,S.exportAsImage)(e)}catch(e){i({type:"error",dangerouslyUseHTMLString:!0,message:h.Ol})}l("close"),o.value=!1}catch(e){i({type:"error",dangerouslyUseHTMLString:!0,message:h.v7})}}}}}),x=(0,i(83744).Z)(E,[["render",function(e,l,i,u,d,p){const m=(0,a.up)("el-alert"),f=(0,a.up)("el-switch"),s=(0,a.up)("el-form-item"),g=(0,a.up)("el-input"),c=(0,a.up)("el-option"),w=(0,a.up)("el-select"),y=(0,a.up)("el-slider"),k=(0,a.up)("el-col"),v=(0,a.up)("el-input-number"),b=(0,a.up)("el-row"),F=(0,a.up)("el-form-item-group"),h=(0,a.up)("el-button"),S=(0,a.up)("el-form"),D=(0,a.Q2)("loading");return(0,a.wy)(((0,a.wg)(),(0,a.j4)(S,{ref:"form",action:"javascript:void(0)","label-position":"left",model:e.formData.workingFile,rules:e.formValidationRules,novalidate:"novalidate","hide-required-asterisk":"",onSubmit:e.onCreate},{default:(0,a.w5)((()=>[e.canSaveBackDirectly?((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[(0,a.Wm)(m,{type:"info",title:e.$t("module.fileExport.saveBackIntroduction",{fileName:e.fileHandle.name}),"show-icon":"",closable:!1,class:"mb-4"},null,8,["title"]),(0,a.Wm)(s,{label:e.$t("module.fileExport.saveBackQuestion")},{default:(0,a.w5)((()=>[(0,a.Wm)(f,{modelValue:e.formData.workingFile.saveBackDirectly,"onUpdate:modelValue":l[0]||(l[0]=l=>e.formData.workingFile.saveBackDirectly=l),"active-text":e.$t("button.yes"),"inactive-text":e.$t("button.no")},null,8,["modelValue","active-text","inactive-text"])])),_:1},8,["label"])],64)):(0,a.kq)("v-if",!0),(0,a.Wm)(F,null,{default:(0,a.w5)((()=>[(0,a.Wm)(t.Transition,{name:"scale-down"},{default:(0,a.w5)((()=>[e.formData.workingFile.saveBackDirectly?(0,a.kq)("v-if",!0):((0,a.wg)(),(0,a.j4)(s,{key:0,label:e.$t("module.fileExport.fileName"),prop:"fileName"},{default:(0,a.w5)((()=>[(0,a.Wm)(g,{modelValue:e.formData.workingFile.fileName,"onUpdate:modelValue":l[1]||(l[1]=l=>e.formData.workingFile.fileName=l),clearable:""},null,8,["modelValue"])])),_:1},8,["label"]))])),_:1}),(0,a.Wm)(t.Transition,{name:"scale-down"},{default:(0,a.w5)((()=>[e.formData.workingFile.saveBackDirectly?(0,a.kq)("v-if",!0):((0,a.wg)(),(0,a.j4)(s,{key:0,label:e.$t("module.fileExport.fileType"),prop:"fileType"},{default:(0,a.w5)((()=>[(0,a.Wm)(w,{modelValue:e.formData.workingFile.fileType,"onUpdate:modelValue":l[2]||(l[2]=l=>e.formData.workingFile.fileType=l)},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.fileTypeOptions,(e=>((0,a.wg)(),(0,a.j4)(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["label"]))])),_:1}),(0,a.Wm)(s,{label:e.$t("module.fileExport.layers"),prop:"layerSelection"},{default:(0,a.w5)((()=>[(0,a.Wm)(w,{modelValue:e.formData.workingFile.layerSelection,"onUpdate:modelValue":l[3]||(l[3]=l=>e.formData.workingFile.layerSelection=l)},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.layerSelectionOptions,(e=>((0,a.wg)(),(0,a.j4)(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["label"]),(0,a.Wm)(t.Transition,{name:"scale-down"},{default:(0,a.w5)((()=>[e.showQualitySetting?((0,a.wg)(),(0,a.j4)(s,{key:0,label:e.$t("module.fileExport.quality"),prop:"quality"},{default:(0,a.w5)((()=>[(0,a.Wm)(b,null,{default:(0,a.w5)((()=>[(0,a.Wm)(k,{span:14},{default:(0,a.w5)((()=>[(0,a.Wm)(y,{modelValue:e.formData.workingFile.quality,"onUpdate:modelValue":l[4]||(l[4]=l=>e.formData.workingFile.quality=l),"show-tooltip":!1},null,8,["modelValue"])])),_:1}),(0,a.Wm)(k,{span:10},{default:(0,a.w5)((()=>[(0,a.Wm)(v,{modelValue:e.formData.workingFile.quality,"onUpdate:modelValue":l[5]||(l[5]=l=>e.formData.workingFile.quality=l),min:0,max:100,precision:0,class:"el-input--text-right"},{append:(0,a.w5)((()=>[n])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["label"])):(0,a.kq)("v-if",!0)])),_:1}),(0,a.Wm)(t.Transition,{name:"scale-down"},{default:(0,a.w5)((()=>[e.showDitheringSetting?((0,a.wg)(),(0,a.j4)(s,{key:0,label:e.$t("module.fileExport.dithering"),prop:"dithering"},{default:(0,a.w5)((()=>[(0,a.Wm)(w,{modelValue:e.formData.workingFile.dithering,"onUpdate:modelValue":l[6]||(l[6]=l=>e.formData.workingFile.dithering=l)},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.ditheringOptions,(l=>((0,a.wg)(),(0,a.j4)(c,{key:l.value,label:e.$t(l.label),value:l.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["label"])):(0,a.kq)("v-if",!0)])),_:1})])),_:1}),(0,a._)("div",r,[(0,a.Wm)(h,{onClick:e.onCancel},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.toDisplayString)(e.$t("button.cancel")),1)])),_:1},8,["onClick"]),(0,a.Wm)(h,{type:"primary","native-type":"submit"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.toDisplayString)(e.$t("button.export")),1)])),_:1})])])),_:1},8,["model","rules","onSubmit"])),[[D,e.loading]])}]])}}]);